<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phân tích Tài/Xỉu VIP PRO</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Exo 2', sans-serif;
      background: linear-gradient(135deg, #0a0a23, #4b0082);
      color: #ffffff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    .container {
      max-width: 500px;
      width: 100%;
      padding: 20px;
      background: rgba(10, 10, 35, 0.9);
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 255, 204, 0.7);
      backdrop-filter: blur(8px);
      position: relative;
    }
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(0, 255, 204, 0.2), transparent);
      opacity: 0.3;
      animation: glow 5s infinite;
    }
    @keyframes glow {
      0% { transform: translateX(-100%); }
      50% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    h1 {
      font-size: 1.8em;
      color: #00ffcc;
      text-shadow: 0 0 8px #00ffcc;
      text-align: center;
      margin-bottom: 15px;
      letter-spacing: 1px;
    }
    input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      font-size: 0.95em;
      box-shadow: inset 0 0 5px rgba(0, 255, 204, 0.4);
      transition: box-shadow 0.3s;
    }
    input:focus {
      outline: none;
      box-shadow: 0 0 10px #00ffcc;
    }
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 15px 0;
    }
    button {
      padding: 8px 18px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(45deg, #00ffcc, #8b00ff);
      color: #ffffff;
      font-size: 0.85em;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px #00ffcc;
    }
    .loader {
      display: none;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top: 3px solid #00ffcc;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      animation: spin 0.8s linear infinite;
      margin: 10px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #result {
      font-size: 1.1em;
      color: #00ffcc;
      text-align: center;
      margin: 10px 0;
      padding: 8px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
    }
    .error {
      color: #ff4d4d;
      text-shadow: 0 0 5px #ff4d4d;
    }
    #history {
      margin-top: 15px;
      max-height: 120px;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 8px;
      font-size: 0.8em;
    }
    #history p {
      color: #e0e0e0;
      margin: 4px 0;
      padding: 4px;
      border-left: 2px solid #00ffcc;
    }
    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }
      h1 {
        font-size: 1.5em;
      }
      button {
        padding: 7px 15px;
        font-size: 0.8em;
      }
      input {
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Phân tích Tài/Xỉu VIP PRO</h1>
    <input type="text" id="md5Input" placeholder="Nhập mã MD5...">
    <div class="controls">
      <button onclick="runAnalysis()">Phân tích VIP</button>
      <button onclick="clearHistory()">Xóa lịch sử</button>
    </div>
    <div class="loader" id="loader"></div>
    <div id="result"></div>
    <div id="history">
      <h3>Lịch sử</h3>
      <div id="historyContent"></div>
    </div>
  </div>

  <!-- Thư viện CryptoJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <!-- Âm thanh -->
  <audio id="successSound">
    <source src="https://www.myinstants.com/media/sounds/success.mp3" type="audio/mpeg">
  </audio>

  <script>
    let history = [];
    let lastResult = null;
    let bridgeCount = 0;

    function validateMD5(input) {
      return /^[a-f0-9]{32}$/i.test(input);
    }

    function analyzeMD5VIP(input) {
      let hash = input;
      const timestamp = Date.now();

      // Bước 1: Hash 180 lần, kết hợp timestamp
      for (let i = 0; i < 180; i++) {
        hash = CryptoJS.MD5(hash + (timestamp % (i + 1))).toString();
      }

      // Bước 2: Lấy chuỗi đầu + cuối, nhân 8, chia 19
      const head = parseInt(hash.slice(0, 16), 16);
      const tail = parseInt(hash.slice(-16), 16);
      const sum1 = ((head + tail) * 8) / 19;

      // Bước 3: Hash tiếp 300 lần
      let finalHash = hash;
      for (let i = 0; i < 300; i++) {
        finalHash = CryptoJS.MD5(finalHash + (timestamp % (i + 1))).toString();
      }

      // Bước 4: Lấy 16 số đầu, chuyển thành thập phân
      const sum2 = parseInt(finalHash.slice(0, 16), 16);

      // Bước 5: Kết hợp 2 tổng, chia 8, lấy 2 số giữa
      const combined = (sum1 + sum2).toString();
      const middleIndex = Math.floor(combined.length / 2);
      const finalScore = parseInt(combined.slice(middleIndex - 1, middleIndex + 1), 10);

      // Bước 6: Đảo cầu
      let result = finalScore > 50 ? 'Tài' : 'Xỉu';
      if (lastResult && bridgeCount < 3) {
        if (lastResult === result) {
          bridgeCount++;
          if (bridgeCount === 3) {
            result = result === 'Tài' ? 'Xỉu' : 'Tài';
            bridgeCount = 0;
          }
        } else {
          bridgeCount = 0;
        }
      }
      lastResult = result;

      // Giả lập đúng/sai dựa trên lịch sử
      const correct = history.length > 0 && Math.random() > 0.4 ? 'Đúng' : 'Sai';
      return { result, correct, finalScore };
    }

    function runAnalysis() {
      const input = document.getElementById("md5Input").value.trim();
      const resultDiv = document.getElementById("result");
      const loader = document.getElementById("loader");
      const sound = document.getElementById("successSound");

      resultDiv.innerHTML = "";
      loader.style.display = "block";

      if (!input) {
        setTimeout(() => {
          loader.style.display = "none";
          resultDiv.innerHTML = '<span class="error">Vui lòng nhập mã MD5!</span>';
        }, 800);
        return;
      }

      if (!validateMD5(input)) {
        setTimeout(() => {
          loader.style.display = "none";
          resultDiv.innerHTML = '<span class="error">Mã MD5 không hợp lệ!</span>';
        }, 800);
        return;
      }

      setTimeout(() => {
        const { result, correct, finalScore } = analyzeMD5VIP(input);
        resultDiv.innerHTML = `Kết quả: <strong>${result}</strong> (${correct}, Điểm: ${finalScore})`;
        loader.style.display = "none";
        sound.play();

        const timestamp = new Date().toLocaleString('vi-VN');
        history.push({ input: input.slice(0, 8) + '...', result, correct, timestamp });
        if (history.length > 5) history.shift();
        updateHistory();
      }, 1000);
    }

    function updateHistory() {
      const historyDiv = document.getElementById("historyContent");
      historyDiv.innerHTML = history.map(item => 
        `<p>${item.timestamp} | Mã: ${item.input} | ${item.result} (${item.correct})</p>`
      ).join('');
    }

    function clearHistory() {
      history = [];
      lastResult = null;
      bridgeCount = 0;
      updateHistory();
    }
  </script>
</body>
</html>
